**Architecture Overview — Rental Backend**



**## 1. Общая структура проекта**



**Проект реализован на \*\*Django + Django REST Framework\*\*, с разделением по доменам:**



**src/**

**│**

**├── bookings/ # Логика бронирований**

**├── listings/ # Модель и API объявлений**

**├── locations/ # Географические данные (страны, города)**

**├── reviews/ # Отзывы и рейтинги**

**├── stats/ # История просмотров и поисков**

**├── users/ # Пользователи и аутентификация**

**│**

**├── common/ # Общие утилиты и кастомные permissions**

**├── config/ # Настройки Django, Celery, Stripe, Docker**

**│**

**└── manage.py**



**2. Архитектура приложения**



**- \*\*База данных:\*\* MySQL (структура в виде взаимосвязанных моделей).**

**- \*\*API:\*\* Django REST Framework (DRF), со схемой `drf-spectacular`.**

**- \*\*Docker:\*\* контейнеризация всех компонентов (API, DB, Nginx, Celery).**

**- \*\*Celery:\*\* очередь фоновых задач (отправка email, уведомления).**

**- \*\*Stripe:\*\* интеграция платежей для аренды.**

**- \*\*JWT:\*\* токенная аутентификация пользователей.**

**- \*\*Swagger / ReDoc:\*\* автогенерация документации API `/api/docs/`.**



**Основные модели**



 **`Listing`**

**- Объявление о жилье.**

**- Параметры: `title`, `description`, `price`, `currency`, `is\_available`, `view\_count`, `rating`.**

**- Логика: CRUD, фильтрация, подсчёт просмотров.**



 **`User`**

**- Роли: `Tenant` (арендатор), `Landlord` (арендодатель).**

**- Использует Django Groups и Permissions.**



 **`Booking`**

**- Связь между `User` (Tenant) и `Listing`.**

**- Проверка пересечений дат в методе `clean()`.**

**- Сигналы:**

  **- при подтверждении брони — другим пользователям с пересекающимися датами статус меняется на `rejected`.**

  **- уведомления через Celery.**



 **`Review`**

**- Пользователи оставляют рейтинг и комментарий после завершённой брони.**

**- Автоматический пересчёт рейтинга `Listing` через сигналы.**



 **`ListingView`**

**- Записывает каждый просмотр объявления пользователем (или по IP).**

**- Используется для аналитики и отображения "популярных объявлений".**



 **`SearchHistory`**

**- Фиксирует поисковые запросы пользователей.**

**- Используется для анализа и вывода популярных запросов (`/api/listings/search-trends/`).**



**---**



 **4. Поток данных (пример)**



**1. Пользователь (Tenant) выполняет поиск:**  

   **→ `GET /api/listings/?search=Berlin`**  

   **→ запрос записывается в `SearchHistory`.**



**2. Пользователь открывает объявление:**  

   **→ `GET /api/listings/15/`**  

   **→ создаётся запись в `ListingView`, увеличивается `view\_count`.**



**3. Пользователь оформляет бронь:**  

   **→ `POST /api/bookings/`**  

   **→ триггерится проверка пересечений и отправка писем.**



**4. После завершения — может оставить отзыв:**

   **→ `POST /api/reviews/`**



**---**



 **5. Логирование**



**- Все ключевые события (создание, обновление, ошибки) пишутся в `src/logs/app.log`.**

**- Формат записи: `\[дата]\[уровень]\[модуль]: сообщение`.**



**---**



 **6. Автоматизация и контейнеризация**



**- `docker-compose.yml` поднимает сервисы:**

  **- \*\*api\*\* (Gunicorn)**

  **- \*\*db\*\* (MySQL)**

  **- \*\*nginx\*\***

  **- \*\*celery / redis\*\***



**---**



 **7. Безопасность и права доступа**



**- Только арендодатели могут создавать объявления.**

**- Только владельцы могут редактировать или удалять их.**

**- Арендаторы могут оставлять отзывы только после завершённой брони.**



**---**



 **8. API Документация**



**- `/api/docs/` — Swagger UI**  

**- `/api/redoc/` — ReDoc**  

**- `/api/schema/` — OpenAPI JSON**



**---**



 **9. Расширения**



**В будущем можно добавить:**

**- уведомления WebSocket (Django Channels);**

**- ElasticSearch для улучшенного поиска;**

**- Telegram-бот для быстрых бронирований.**

