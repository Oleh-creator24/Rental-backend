{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Äî –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞{% endblock %}

{% block content %}
<h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</h1>
<hr>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
    <div class="card">
        <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —Ä–æ–ª—è–º</h3>
        <canvas id="usersChart"></canvas>
    </div>

    <div class="card">
        <h3>–û–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ –≥–æ—Ä–æ–¥–∞–º</h3>
        <canvas id="listingsChart"></canvas>
    </div>

    <div class="card" style="grid-column: span 2;">
        <h3>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h3>
        <canvas id="bookingsChart"></canvas>
    </div>
</div>

<style>
    .card {
        background-color: var(--body-bg);
        color: var(--body-fg);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    h1, h3 {
        color: var(--header-color, #2e7d32);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // –î–∞–Ω–Ω—ã–µ –∏–∑ Django (–æ–Ω–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ context)
    const analyticsData = JSON.parse('{{ analytics_json|escapejs }}');

    // --- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —Ä–æ–ª—è–º ---
    new Chart(document.getElementById('usersChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(analyticsData.users_by_role),
            datasets: [{
                data: Object.values(analyticsData.users_by_role),
                backgroundColor: ['#4caf50', '#2196f3'],
            }]
        },
        options: { responsive: true }
    });

    // --- –û–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ –≥–æ—Ä–æ–¥–∞–º ---
    new Chart(document.getElementById('listingsChart'), {
        type: 'bar',
        data: {
            labels: Object.keys(analyticsData.listings_by_city),
            datasets: [{
                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π',
                data: Object.values(analyticsData.listings_by_city),
                backgroundColor: '#ff9800',
            }]
        },
        options: { responsive: true }
    });

    // --- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º ---
    new Chart(document.getElementById('bookingsChart'), {
        type: 'pie',
        data: {
            labels: Object.keys(analyticsData.bookings_by_status),
            datasets: [{
                data: Object.values(analyticsData.bookings_by_status),
                backgroundColor: ['#8bc34a', '#f44336', '#ffc107', '#9e9e9e'],
            }]
        },
        options: { responsive: true }
    });
</script>
{% endblock %}
